---
title: "A2 - Análisis estadístico I"
author: "Fernando Antonio Barbeiro Campos - fbarbeiro@uoc.edu"

date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_libraries, include=FALSE}
library(knitr)
```
# Introducción

<div style="text-align: justify">
En esta actividad usaremos el fichero de **World Happiness Report** “limpio”, es decir, después del preproceso que se ha realizado. Una vez el fichero está preparado, pasaremos a realizar análisis propios de la estadística descriptiva e inferencial. Os proporcionamos el fichero **2016_clean.csv** para que todos trabajéis con el mismo fichero de datos, independientemente del resultado obtenido en la actividad 1.
Recordamos que el fichero de datos recoge información sobre el grado de felicidad de países del mundo. El archivo contiene 157 registros y 13 variables. Estas variables son: *Country, Region, HR, HS, LCI, UCI, GpC, Family, LE, Freedom, GC, Generosity, DR donde HR: Happiness Rank, HS: Happiness Score, LCI y UCI*:
*Lower y Upper Confidence Interval, GpC: GDP per Capita, LE: Life Expectancy, GC: Trust Government Corruption, DR: Dystopia.*
Recordar que **no** se pueden realizar listados completos de los datos en la solución. El motivo es que se generan ficheros de salida con centenares de páginas que son muy difícil de trazar y corregir. Para comprobar las funcionalidades del código, podéis usar **head** y **tail** que solo muestran unas líneas del fichero.
</div>

```{r chunck1}
# Loading the dataframe
df <- read.csv("../2016_clean.csv")
head(df)
```

# 1. Estadística Descriptiva
<div style="text-align: justify">
*A continuación, se estudiarán algunos valores centrales y de dispersión de algunas variables del fichero. Realizar los pasos que se indican a continuación.*
</div>

## 1.1 Valores centrales de HS (*Happiness Score*)
<p style="text-align: justify">
Calcular la media, mediana y el sumario de cinco números (de Tukey) del valor HS Happiness Score de toda la muestra. A continuación, visualizar la distribución de este valor en un diagrama de caja (boxplot) e interpretar el resultado. Finalmente, visualizar otro diagrama de caja donde se muestre el valor de HS para cada región. Es decir, en el mismo gráfico debe haber una caja para cada región representada en el fichero. Interpretar los gráficos.
</p>
### Respuesta
```{r chunck2}
N <- length(df$HS)
# Media de Happiness Score
mean(df$HS) # Using function
sum(df$HS)/N # Manually calculating

#Mediana
median(df$HS)
HS_sorted <- sort(df$HS)

if((N %% 2) == 0) {
  print(paste("Mi mediana calculada es", (HS_sorted[floor((N+1)/2)] + HS_sorted[ceiling((N+1)/2)]) / 2))
} else {
  print(paste("Mi mediana calculada es", HS_sorted[(N+1)/2]))
}

# five numbers (Tukey)
fivenum(df$HS)
# five numbers + media
summary(fivenum(df$HS))

# One by one - manually
min(df$HS)
quantile(df$HS, 0.25) # Mediana del "bottom half"
median(df$HS)
quantile(df$HS, 0.75) # Mediana del "top half"
max(df$HS)

boxplot(df$HS)
```

<p style="text-align: justify">
La interpretación del gráfico de caja sobre la distribución de los valores de *Happiness Score* es bastante sencilla. En la parte más inferior del gráfico tenemos la línea del **valor mínimo** (2.905, según hemos extraído en  el sumario de cinco números). Entonces el dibujo de la caja en sí empieza en el **primer cuartil Q1** - 4.404 - que representa 25%, o sea, la mediana del *bottom half* de nuestra muestra. La próxima línea que tenemos trazada más en negrita es **la mediana - 5.314**, y en la parte superior de la caja, el **cuartil Q3 75%** - 6.269 -> mediana del *top half* de la muestra. Finalmente, la última línea superior arriba de la caja llega hasta al **valor máximo** de la muestra que es 7.526.
</p>

```{r chunck3}
summary(df$Region)

# Grafico para cada región representada
boxplot(df$HS ~ df$Region, main="Happiness Score by Region", ylab="Happiness Score", las=2)
```

##1.2 Cálculos sobre Generosity e identificación de outliers
<p style="text-align: justify">
Calcular la media, mediana y el sumario de cinco números (de Tukey) del valor Generosity de toda la muestra. Visualizar en un diagrama de caja (boxplot) e interpretar el resultado. ¿Existe algún outlier observable en HS o en Generosity? ¿Cómo afectan los outliers a los valores centrales calculados?
</p>

### Respuesta
```{r chunck4}
mean(df$Generosity) 
median(df$Generosity)
fivenum(df$Generosity)
summary(fivenum(df$Generosity))
boxplot(df$Generosity, main="Box plot Generosity")
```
<p style="text-align: justify">
Nuestro boxplot permite observar algunos valores outliers en *Generosity*: empezamos por la parte de abajo del gráfico: considerando que es un conjunto de datos que ha pasado por el preproceso (o sea, está limpio), las entradas de **valores mínimos** están en 0.0. El primer cuartil **Q1** empieza en 0.1546, con la línea **mediana** en negrita a 0.2225. Mientras tanto, el **Q3** representa un valor de 0.3119. Y por arriba de la línea max, **hay una serie de *outliers*** alrededor del valor 0.6 y llegando hasta el **máximo** de 0.8197.
</p>
<p style="text-align: justify">
Los *outliers* afectan especialmente a la media (**poco robusta**). Y cuando la muestra es pequeña, el efecto se nota aún más acentuado. Para representar que puede pasar, veamos un ejemplo:
</p>


```{r chunck5}
#¿Cómo afectan los outliers a los valores centrales calculados?
i1 <- c(1,1,1,2,1,1,2,1,1,2,1,3,3,2,3,2,2,4,1,1)
mean(i1)
median(i1)

i2 <- c(i1, 150)
mean(i2)
median(i2)
```

<p style="text-align: justify">
En **i1** se observa un conjunto bastante uniformemente distribuído, sin *outliers*, por lo tanto, la media y mediana están cerca una de la otra. Sin embargo, cuando añadimos un *outlier* en un nuevo conjunto **i2**, los valores han cambiado muchísimo para la media - ha subido hacia al valor más alto. Mientras tanto, mediana mantuvo un valor en el medio del listado. Este es un ejemplo de que acabamos de decir sobre la afectación de **medidas poco robustas**.
</p>
